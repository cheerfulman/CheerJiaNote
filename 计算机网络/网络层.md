# 网络层

使用ip协议将物理网络连接起来；

IP协议配套使用的三个协议：

- 地址解析协议 ARP（Address Resolution Protocol）
- 网际控制报文协议 ICMP（Internet Control Message Protocol）
- 网际组管理协议 IGMP（Internet Group Management Protocol）

## IP地址编址方式

**1、分类**

由两部分组成，网络号和主机号，其中不同分类具有不同的网络号长度，并且是固定的。

**IP 地址 ::= {< 网络号 >, < 主机号 >}**

**2、子网划分**

拿出主机号一部分作为子网号，把两级 `IP` 地址划分为三级 `IP` 地址。

**IP 地址 ::= {< 网络号 >, < 子网号 >, < 主机号 >}**

**3、无分类**

无分类编址 `CIDR` 消除了传统 A 类、B 类和 C 类地址以及划分子网的概念，使用网络前缀和主机号来对 `IP` 地址进行编码，网络前缀的长度可以根据需要变化。

**IP 地址 ::= {< 网络前缀号 >, < 主机号 >}**

`CIDR` 的记法上采用在 `IP` 地址后面加上网络前缀长度的方法，例如 128.14.35.7/20 表示前 20 位为网络前缀。

## 网际控制报文协议 ICMP

ICMP 是为了更有效地转发 IP 数据报和提高交付成功的机会。它封装在 IP 数据报中，但是不属于高层协议。

![img](https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/e3124763-f75e-46c3-ba82-341e6c98d862.jpg)

### 1. Ping

通过Ping命令可以测试两台主机之间的连通性；

Ping原理：发生ICMP Echo请求报文，目的主机收到后发生Echo回答报文；

### 2.Traceroute

用来跟踪一个分组从源点到终点的路径。

## VPN

VPN有三个专用地址块：

- 10.0.0.0 ~ 10.255.255.255
- 172.16.0.0 ~ 172.31.255.255
- 192.168.0.0 ~ 192.168.255.255

如果X要与Y通信，则先源地址10.1.0.1通过NAT协议转化为125.1.2.3跟目的地地址10.2.0.3通过NAT协议转化为194.4.5.6（全球地址）通信，路由器R2数据报后将数据部分进行解密，恢复原来的数据报，此时目的地址为 10.2.0.3，就交付给 Y。

![img](https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/1556770b-8c01-4681-af10-46f1df69202c.jpg)

## 网络地址转换NAT

当专用网内部主机使用本地IP相遇互联网主机通信时，用NAT将本地 IP 转换为全球 IP。

**目前多个专用网内部的主机共用一个全球 IP 地址。**

![img](https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/2719067e-b299-4639-9065-bed6729dbf0b.png)

## 路由选择协议

可以把路由选择协议划分为两大类：

- 自治系统内部的路由选择：RIP 和 OSPF
- 自治系统间的路由选择：BGP

### RIP

RIP是基于距离向量的路由选择协议，**最大跳数15**；

RIP 按固定的时间间隔仅和相邻路由器交换自己的路由表，经过若干次交换之后，所有路由器最终会知道到达本自治系统中任何一个网络的最短距离和下一跳路由器地址。

网络规模一般较小，毕竟15跳。

### ospf

开放最短路径优先 OSPF，是为了克服 RIP 的缺点而开发出来的。

开放表示 OSPF 不受某一家厂商控制，而是公开发表的；最短路径优先表示使用了 Dijkstra 提出的最短路径算法 SPF。

OSPF 具有以下特点：

- 向本自治系统中的所有路由器发送信息，这种方法是洪泛法。
- 发送的信息就是与相邻路由器的链路状态，链路状态包括与哪些路由器相连以及链路的度量，度量用费用、距离、时延、带宽等来表示。
- 只有当链路状态发生变化时，路由器才会发送信息。

所有路由器都具有全网的拓扑结构图，并且是一致的。相比于 RIP，OSPF 的更新过程收敛的很快。

### BGP

边际网关协议：规模很大；