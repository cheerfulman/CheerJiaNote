# 传输层

传输层提供了进程间的逻辑通信。

## UDP和TCP

+ 用户数据报协议 UDP:无连接的，尽最大可能交付,面向报文，支持一对一、一对多、多对一和多对多的交互通信.
+ 传输控制协议 TCP：面向连接的，提供可靠交付，支持全双工通信，只能点对点，面向字节流的；

## TCP保证可靠性

### 流量控制

通过控制发生方的窗口大小，控制发送速率

### 拥塞控制

拥塞控制是作用于网络的，它是防止过多的数据注入网络，避免出现网络负载过大的情况，常见的方法就是

- 慢开始、拥塞避免
- 快重传、快恢复

#### 慢开始

刚开始有一个拥塞窗口cwnd，是一个动态变化的值（网络环境是不断变化的）。

慢开始：一开始慢慢的，后来快快的，如指数增长(基数小时慢，后来啪的一下就站起来了，很快啊(马保国) )；

![image-20200623214100440](https://gitee.com/moxi159753/LearningNotes/raw/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_TCP%E4%B8%AD%E7%9A%84%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E5%92%8C%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6/images/image-20200623214100440.png)

> 发送方没收到一个确认窗口，就把窗口cwnd加1

为了防止`cwnd`增长过大引起网络拥塞，还需设置一个慢开始门限`ssthresh`状态变量，`ssthresh`的用法如下：

- 当 `cwnd` > `ssthresh`时：使用慢开始算法
- 当`cwnd` = `ssthresh`时：采用 慢开始或拥塞避免中的任意一种
- 当 `cwnd` > `ssthresh`时：采用拥塞避免算法

#### 拥塞避免

慢开始阶段：即每经过一个往返时间RTT就把发送方的拥塞窗口cwnd加1，而不是加倍；

当cwnd = 门限值 ssthresh时，采用拥塞避免，拥塞窗口按线性规律增长；

当网络拥塞时，将门限值ssthresh设置成拥塞的一半，然后重新从初始位置开始，采用慢开始算法；

![image-20200623220009542](https://gitee.com/moxi159753/LearningNotes/raw/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_TCP%E4%B8%AD%E7%9A%84%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E5%92%8C%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6/images/image-20200623220009542.png)

#### 快重传

当接收方接收到一个失序报文段后，发出重复确定，如果发送方连续收到三个重复确定(**代表没有出现网络拥塞**)，不必等到重传计时器到时，立刻重传；

+ 重传计时器：发生方在一段时间内没有收到接收方的确认报文，则重传；

![image-20200623221705052](https://gitee.com/moxi159753/LearningNotes/raw/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_TCP%E4%B8%AD%E7%9A%84%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E5%92%8C%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6/images/image-20200623221705052.png)

#### 快恢复

一般与快重传配合：

+ 当发生方连续收到三个重复确认时，将门限值ssthresh值设置为拥塞的一半，此时不执行慢开始，而是直接将cwnd设置为 ssthresh的值（快恢复）

  ![image-20200623222155538](https://gitee.com/moxi159753/LearningNotes/raw/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_TCP%E4%B8%AD%E7%9A%84%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E5%92%8C%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6/images/image-20200623222155538.png)

  

**慢开始算法只是在TCP连接建立时和网络出现超时时才使用**