# MySQL

## 存储引擎

MyISAM: 不支持事务，默认表锁，非聚集索引。

InnoDB: 支持事物，默认行级锁,聚集索引。

Memory: 内存存储引擎，针对临时表，速度快。

|      | Innodb | Myisam |
| ---- | ---- | ---- |
| 存储文件 | .frm表定义文件<br>**.idb 数据文件和索引文件** | .frm表定义文件<br>**.myd 数据文件**<br>**.myi 索引文件** |
| 锁 | 表锁、**行锁**（产生死锁） | 表锁 |
| 事物 | 支持 | 不支持 |
| CRUD | 读、写 | 读多 |
| count | 扫表 | 专门存储的地方 |
| 索引结构 | B+ tree | B+ tree |

## 索引

劣势：

+ **占据磁盘空间**
+ **虽然提高了查询效率，但是降低更新表的效率**。每次增删改差后，还要保存和更新对应的索引文件

优势：

+ **提高查询效率**
+ **通过索引对数据进行排序，降低排序成本，和cpu消耗。**

---

### 单列索引：

1. 普通索引：在MySQL中基本没什么限制，允许重复的值和空值
2. 唯一索引：列中值必须唯一，但是可以为空
3. 主键索引：是特殊的索引，不允许为空

### 组合索引：

+ 在多个字段组合创建的一个索引 --- 叫组合索引
+ 遵循最左前缀原则
+ 一般使用 组合索引，代替单列索引
+ 根据你创建字段的顺序比对

### 为什么用B+ Tree 而不用 平衡二叉树

**树的方式分批加载，第一次根节点，然后第二层节点，进行分批加载。**

**二叉树深度深，IO次数过多。**

每一次加载都是一次IO



B+ Tree 只有叶子节点存值。

**主键为什么最好用自增，并且不用varchar做主键？**

由于B+ 树 叶子节点是排好序的，如果插入时不按顺序，那么就要重新排序。

**如果没有主键索引,就会选一个唯一非空列，如果这个列都找不到，就会创建一个隐藏列。**

如果使用非主键查询，则需要搜索两次索引树（一次辅助索引，一次主键索引）

### 聚集索引（Innodb）

**表数据和索引在一起的就是聚集索引**

#### 主键索引

有且只有一个

#### 辅助索引

（根据索引多少就可以有多少个）

### 非聚集索引（Mysiam）

![image-20200704150742048](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20200704150742048.png)

> 为什么InnoDB必须包含一个主键，并且推荐主键使用整型的自增？

答：如果你没建主键，他会自动查找一个个列，找到一个没有重复的列的取其为索引，如果所有字段都有重复的，MySQL则会创建一个隐藏列为索引。 你建了主键就会通过主键维护所有数据，减少了MySQL的负担，不然他要自己寻找。

整形方便比大小，然后自增是为